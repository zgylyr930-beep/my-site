<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>é‡ç”Ÿä¹‹æˆ‘åœ¨è®¾è®¡é™¢ç”»å›¾ - 15.1 è¡¥ä¸ç‰ˆ</title>
    <style>
        :root {
            --bg: #ffffff;
            --text: #000000;
            --border: #000000;
        }

        /* ä¿®å¤å±…ä¸­é—®é¢˜çš„æ ¸å¿ƒè¡¥ä¸ */
        body {
            font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;             /* å¯ç”¨ Flex å¸ƒå±€ */
            justify-content: center;    /* æ°´å¹³å±…ä¸­ */
            align-items: center;        /* å‚ç›´å±…ä¸­ */
            height: 100vh;              /* å æ®æµè§ˆå™¨å…¨é«˜ */
            width: 100vw;
            overflow: hidden;           /* é˜²æ­¢æ»šåŠ¨æ¡å¹²æ‰°å±…ä¸­ */
        }

        /* æ¸¸æˆä¸»åŒ…è£¹æ¡† */
        #main-wrapper {
            width: 95%;
            max-width: 800px;
            height: 90vh;               /* é™åˆ¶é«˜åº¦åœ¨è§†å£å†… */
            display: flex;
            flex-direction: column;
            padding: 25px;
            box-sizing: border-box;
            border: 5px solid var(--border); /* æ”¹ä¸ºå…¨è¾¹æ¡†ï¼Œæ›´ç¾è§‚ */
            background: #fff;
            position: relative;
        }

        /* çŠ¶æ€æ ï¼šæ¨¡å—åŒ–è®¾è®¡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            border: 4px solid var(--border);
            margin-bottom: 15px;
            flex-shrink: 0;
        }
        .stat-item {
            padding: 8px;
            text-align: center;
            border-right: 3px solid var(--border);
        }
        .stat-item:last-child { border-right: none; }
        .stat-label { font-size: 12px; font-weight: 900; color: #555; }
        .stat-val { font-size: 15px; display: block; margin-top: 4px; font-weight: bold; }

        /* è¿›åº¦æ¡ */
        #progress-bar {
            width: 100%;
            height: 12px;
            border: 3px solid var(--border);
            margin-bottom: 15px;
            background: #fff;
        }
        #progress-inner { height: 100%; background: var(--border); width: 0%; transition: width 0.3s; }

        /* å†…å®¹æ»šåŠ¨åŒº */
        #scene-box {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding-right: 5px;
        }

        /* æ¼«ç”»æ’ç”» */
        #manga-frame {
            width: 100%;
            height: 250px;
            flex-shrink: 0;
            border: 4px solid var(--border);
            margin-bottom: 15px;
            background: #fff;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }
        #manga-img {
            width: 100%; height: 100%; object-fit: cover;
            filter: grayscale(100%) contrast(1.3);
        }

        #scene-header {
            font-size: 13px; font-weight: 900;
            border-bottom: 3px solid var(--border);
            padding-bottom: 5px; margin-bottom: 10px;
            display: flex; justify-content: space-between;
        }

        #scene-body { font-size: 16px; line-height: 1.6; margin-bottom: 15px; }

        /* è­¦å‘Šæç¤º */
        #warning-hint {
            border: 2px solid #000;
            background: #fdfd96; /* æµ…é»„è‰²æç¤º */
            padding: 8px;
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 15px;
            display: none;
        }

        /* é€‰é¡¹æŒ‰é’® */
        .options-group { display: flex; flex-direction: column; gap: 8px; }
        .opt-btn {
            background: #fff; border: 3px solid var(--border);
            padding: 12px; font-size: 14px; font-weight: 900;
            text-align: left; cursor: pointer;
        }
        .opt-btn:hover { background: #000; color: #fff; }
        .opt-quit { border-style: dashed; color: #666; }

        /* å•†åº— */
        #shop {
            margin-top: 15px; padding: 10px; border: 3px solid var(--border);
            display: flex; gap: 10px; align-items: center; flex-shrink: 0;
        }
        .shop-btn {
            background: #eee; border: 2px solid var(--border);
            padding: 5px 10px; font-size: 11px; font-weight: bold; cursor: pointer;
        }

        /* è¦†ç›–å±‚ */
        .overlay {
            position: fixed; inset: 0; background: #fff; z-index: 1000;
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; text-align: center; padding: 40px;
        }
        .hide { display: none !important; }
        
        #quit-modal {
            position: fixed; inset: 0; background: rgba(255,255,255,0.9);
            z-index: 2000; display: flex; justify-content: center; align-items: center;
        }
        #quit-box {
            width: 80%; max-width: 400px; background: #fff;
            border: 6px solid #000; padding: 25px;
            box-shadow: 10px 10px 0px #000;
        }

        .btn-black {
            padding: 12px 35px; background: #000; color: #fff;
            border: none; font-size: 18px; font-weight: 900; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="welcome" class="overlay">
        <h1 style="font-size: 42px; border: 10px solid #000; padding: 20px;">é‡ç”Ÿä¹‹æˆ‘åœ¨è®¾è®¡é™¢ç”»å›¾</h1>
        <p style="font-weight: 900; font-size: 18px;">â€”â€” å»ºç­‘å¸ˆèŒä¸šé©¬æ‹‰æ¾æ¨¡æ‹Ÿ â€”â€”</p>
        <button class="btn-black" onclick="initGame()">æŠ• èƒ (å¼€å§‹æ¸¸æˆ)</button>
    </div>

    <div id="game-ui" class="hide">
        <div id="main-wrapper">
            <div id="progress-bar"><div id="progress-inner"></div></div>
            <div class="stats-grid">
                <div class="stat-item"><span class="stat-label">å¤©æ•°</span><span id="day-val" class="stat-val">1</span></div>
                <div class="stat-item"><span class="stat-label">å‘é‡</span><span id="hair-val" class="stat-val">100k</span></div>
                <div class="stat-item"><span class="stat-label">å¿ƒæ™º</span><span id="sanity-val" class="stat-val">100</span></div>
                <div class="stat-item"><span class="stat-label">å£°æœ›</span><span id="rep-val" class="stat-val">0</span></div>
                <div class="stat-item"><span class="stat-label">å¥–é‡‘</span><span id="money-val" class="stat-val">ï¿¥0</span></div>
            </div>

            <div id="scene-box">
                <div id="scene-header">
                    <span id="rank-name">èŒçº§ï¼šèŒåœºæ–°äºº</span>
                    <span id="stage-num">å…³å¡ 01 / 30</span>
                </div>
                <div id="manga-frame">
                    <img id="manga-img" src="">
                </div>
                <div id="warning-hint"></div>
                <div id="scene-body"></div>
                <div id="options" class="options-group"></div>
                <div id="shop">
                    <span style="font-size: 11px; font-weight: bold;">è¡¥ç»™ç«™ï¼š</span>
                    <button class="shop-btn" onclick="buyItem('coffee')">å†°ç¾å¼ ï¿¥200 (+25 å¿ƒæ™º)</button>
                    <button class="shop-btn" onclick="buyItem('wig')">ç”Ÿå‘æ°´ ï¿¥1000 (+1.5w å‘é‡)</button>
                </div>
            </div>
        </div>
    </div>

    <div id="quit-modal" class="hide">
        <div id="quit-box">
            <div style="font-size: 11px; font-weight: bold; margin-bottom: 10px; text-decoration: underline;">ç³»ç»Ÿæç¤º</div>
            <div id="quit-text" style="font-size: 17px; font-weight: 900; line-height: 1.6; margin-bottom: 25px;"></div>
            <button class="btn-black" onclick="closeQuitModal()">å›åˆ°ç°å®</button>
        </div>
    </div>

    <div id="ending" class="overlay hide">
        <div id="end-status" style="font-size: 48px; border: 8px solid #000; padding: 15px 40px; margin-bottom: 20px;"></div>
        <div id="end-desc" style="max-width: 550px; font-size: 20px; line-height: 1.8;"></div>
    </div>

    <div id="disclaimer-page" class="overlay hide">
        <h2 style="font-size: 36px; border-bottom: 5px solid #000; padding-bottom: 10px;">æœ¬æ¸¸æˆçº¯å±å¨±ä¹ï½</h2>
        <p style="font-weight: 900; margin-top: 20px; line-height: 1.6;">
            èº«ä½“æ˜¯é©å‘½çš„æœ¬é’±ï¼Œè¯·çˆ±æŠ¤å‘é™…çº¿ï¼Œé€‚åº¦åŠ ç­ã€‚<br>
            æ„¿æ¯ä¸€ä½ç‰›é©¬å»ºç­‘å¸ˆéƒ½èƒ½çœ‹åˆ°æ˜å¤©çš„å¤ªé˜³ã€‚
        </p>
        <button class="btn-black" onclick="location.reload()">é‡æ–°æŠ•èƒ</button>
    </div>

<script>
    let state = { step: 0, day: 1, hair: 100000, sanity: 100, rep: 0, money: 0 };

    // å‰§æœ¬ä¸ä¹‹å‰ä¸€è‡´ï¼Œä»…ç¡®ä¿ img è·¯å¾„ä¸ºæœ¬åœ°
    const script = [
        { img: "scene01", t: "å…¥èŒ", b: "æ‹¿åˆ°é€šçŸ¥ä¹¦ï¼Œäººäº‹è¯´ï¼šâ€˜æˆ‘ä»¬å®è¡Œå¼¹æ€§å·¥ä½œåˆ¶â€™ã€‚ä½ åæ¥æ˜ç™½ï¼Œå¼¹æ€§çš„æ„æ€æ˜¯â€˜åªå¾€åå¼¹â€™ã€‚", opts: [{text:"â€œæˆ‘ä¼šåŠªåŠ›å·¥ä½œçš„ï¼â€", h:-100, s:-5, r:10}, {text:"â€œä»€ä¹ˆæ—¶å€™å‘å·¥èµ„ï¼Ÿâ€", s:5, r:-5}]},
        { img: "scene02", t: "æ¸…ç†åº•å›¾", b: "500MBåº•å›¾ï¼Œå…¨æ˜¯â€˜ç‚¸å¼€çš„å—â€™ã€‚åˆé¥­å‰å¿…é¡»æ¸…å®Œã€‚", opts: [{text:"æ‰‹åŠ¨å¼ºæ”¹ï¼Œå·¥åŒ ç²¾ç¥", h:-1000, s:-10, m:200, r:15}, {text:"å…¨é€‰ä¸¢è¿› 0 å±‚", h:-200, s:-5, r:-10}]},
        { img: "scene03", t: "è§„èŒƒå™©æ¢¦", b: "ã€Šé˜²ç«è§„èŒƒã€‹åšåº¦åƒå­—å…¸ï¼Œä½ æ„Ÿè§‰è¿™è¾ˆå­çš„å™©æ¢¦éƒ½åœ¨è¿™ä¹¦é‡Œã€‚", opts: [{text:"é€å­—ç ”è¯»ç¬”è®°", h:-800, s:-10, r:20}, {text:"çœ‹å›¾ç¤ºçç”»", s:-5, r:5}]},
        { img: "scene04", t: "è€æ¿çš„åœ†åœˆ", b: "æ·±å¤œä¸¤ç‚¹ï¼Œè€æ¿ç”»ä¸ªåœ†ï¼šâ€˜è¦ä½“ç°åŸå¸‚ä»£è°¢çš„å‘¼å¸æ„Ÿâ€™ã€‚", opts: [{text:"è¿å¤œæ¨æ•²å“²å­¦æ„ä¹‰", h:-3000, s:-15, r:30, m:1000}, {text:"ç†è§£ä¸ºèŠ±å›", s:-5, r:-10}]},
        { img: "scene05", t: "ç”²æ–¹çš„ç°", b: "ç”²æ–¹å¼ æ€»ï¼šâ€˜ç«‹é¢è¦å¸¦å‘¼å¸æ„Ÿçš„ç°ã€‚â€™ä½ è°ƒäº†20ä¸ªç°åº¦ï¼Œä»–ä¸æ»¡æ„ã€‚", opts: [{text:"å‡ºè‰²å¡è®©ä»–é€‰", h:-1500, s:-15, r:10, m:500}, {text:"è°ƒä½æ˜¾ç¤ºå™¨å¯¹æ¯”åº¦", s:-10, r:-5}]},
        { img: "scene06", t: "å·¥åœ°ä¹‹æ³¥", b: "å·¥åœ°æ³¥æ³ï¼Œé’¢ç­‹å·¥å¸ˆå‚…å†·ç¬‘ï¼šâ€˜è¿™é’¢ç­‹ï¼Œä½ è¡Œä½ æ¥å¡ï¼Ÿâ€™", opts: [{text:"è¹²å‘å•†é‡é¿è®©", h:-1000, s:-10, r:25, m:800}, {text:"æŒ‰å›¾æ–½å·¥è¢«éª‚", s:-30, r:-15}]},
        { img: "scene07", t: "ä¸“ä¸šæ‰“æ¶", b: "æ¢æŒ¡é£ç®¡ï¼Œé£ç®¡å‹åŠé¡¶ã€‚ä¸‰ä¸“ä¸šåœ¨ç¾¤é‡Œå¼€å¯å¤§ä¹±æ–—ã€‚", opts: [{text:"é€šå®µåè°ƒå…¨ä¸“ä¸š", h:-3000, s:-20, r:40, m:1500}, {text:"ç­‰ç»„é•¿è§£å†³", s:10, r:-25}]},
        { img: "scene08", t: "ç¢³ä»£è°¢è¯¾é¢˜", b: "è€æ¿è®©ä½ å†™ç¯‡â€˜æ ¡å›­ç¢³ä»£è°¢æŠ¥å‘Šâ€™ï¼Œå…¨è‹±æ–‡ã€‚", opts: [{text:"æŸ¥SCIæ–‡çŒ®æ ¸ç®—", h:-3000, s:-20, r:60, m:3000}, {text:"æ•°å­—å…¨é ç¼–", s:-5, r:-40}]},
        { img: "scene09", t: "å®¡å›¾é¸Ÿç±»", b: "å®¡å›¾æ„è§ï¼šâ€˜è®ºè¯å»ºç­‘é€ å‹å¯¹å€™é¸Ÿè¿å¾™çš„å½±å“â€™ã€‚", opts: [{text:"æ‰‹ç»˜æ¨¡æ‹Ÿè·¯å¾„", h:-2000, s:-20, r:35, m:2000}, {text:"ä¹°ä¸“å®¶è®¤è¯", s:10, r:-20, m:-1000}]},
        { img: "scene10", t: "æ™‹å‡PM", b: "ä½ æ™‹å‡ä¸ºPMã€‚ç°åœ¨æ‰‹æœº24å°æ—¶éƒ½åœ¨éœ‡åŠ¨ã€‚", opts: [{text:"å¼€å¯æ‹‰æ‰¯æ¨¡å¼", r:40, m:5000}]},
        { img: "scene11", t: "æ·±å¤œè¯­éŸ³", b: "å‡Œæ™¨ä¸€ç‚¹ã€‚ç”²æ–¹å¼ æ€»è¿å‘10æ¡59ç§’è¯­éŸ³ã€‚", opts: [{text:"ç§’å›ï¼šâ€˜æ”¶åˆ°â€™", h:-4000, s:-25, r:30, m:2500}, {text:"æ˜å¤©å†è¯´", s:15, r:-20}]},
        { img: "scene12", t: "æ±‡æŠ¥æ„å¤–", b: "è§„å§”ä¼šæ±‡æŠ¥å‰ï¼ŒPPTæ–‡ä»¶æŸåä¸”æ— å¤‡ä»½ã€‚", opts: [{text:"è¿å¤œæ‰‹ç»˜è‰å›¾", h:-5000, s:-30, r:50, m:2000}, {text:"ç›´æ¥ç›²è®²", s:-40, r:-80}]},
        { img: "scene13", t: "æ¬ è–ªå±æœº", b: "ç”²æ–¹æ¬ è´¹ï¼Œæœ¬æœˆå¥–é‡‘å½’é›¶ã€‚ä¿¡ç”¨å¡å·²åˆ°æœŸã€‚", opts: [{text:"ç»§ç»­ç”»å›¾", h:-1000, s:-25, r:15}, {text:"æ‚„æ‚„æ‘¸é±¼", s:20, r:-40}]},
        { img: "scene14", t: "åŒæ ‡æŠ˜ç£¨", b: "è€æ¿è¦å‰å«ï¼Œå®¡å›¾è¦ä¿å®ˆã€‚ä½ å¤¹åœ¨ä¸­é—´ã€‚", opts: [{text:"åšä¸¤å¥—å›¾", h:-3000, s:-20, r:20}, {text:"æ‹‰ä¸¤æ–¹äº’æ’•", s:-30, r:40}]},
        { img: "scene15", t: "æ–¹æ¡ˆè¢«æ¯™", b: "è¯„å®¡ä¸“å®¶æŠŠä½ å¾—æ„çš„æ¦‚å¿µæ‰¹å¾—ä¸€æ–‡ä¸å€¼ã€‚", opts: [{text:"æŒ‰ä»–çš„æ”¹", h:-1000, s:-15, r:10}, {text:"ç»´æŠ¤å°Šä¸¥ç¡¬åˆš", s:-15, r:-150}]},
        { img: "scene16", t: "è¿ç»­é€šå®µ", b: "è¿ç»­14å¤©å‡Œæ™¨ä¸¤ç‚¹å›å®¶ã€‚æ¢¦é‡Œå…¨æ˜¯æ¶ˆç«æ “ã€‚", opts: [{text:"æ­»ç£•åˆ°ç›–ç« ", h:-5000, s:-35, r:40, m:4000}, {text:"è¯·å‡ä¸€å¤©", s:30, m:-1500}]},
        { img: "scene17", t: "ç»“æ„å·¨å˜", b: "å¿«å‡ºæ–½å·¥å›¾äº†ï¼Œç”²æ–¹è¦æŠŠè£™æˆ¿æ”¹æŒ‘ç©ºå¤§å ‚ã€‚", opts: [{text:"å…¨ä¸“ä¸šé€šå®µ", h:-6000, s:-40, r:50, m:6000}, {text:"æ‹’ç»ä¿®æ”¹", s:-30, r:-100}]},
        { img: "scene18", t: "åŸå¸‚æ›´æ–°", b: "æ—§æ”¹ç°åœºã€‚å±…æ°‘å› ä¸ºé‡‡å…‰é—®é¢˜æŠŠä½ å›´ä½äº†ã€‚", opts: [{text:"è€å¿ƒè®²è§£æ—¥ç…§", h:-2000, s:-20, r:40, m:1000}, {text:"ç¿»å¢™é€ƒèµ°", s:-20, r:-30}]},
        { img: "scene19", t: "è®ºå›å°´å°¬", b: "å‚åŠ å­¦æœ¯è®ºå›ï¼Œå‘ç°è®²ç¨¿å’Œä¸Šä¸€ä½æ’äº†ã€‚", opts: [{text:"ç°åœºå³å…´æ”¹", h:-2000, s:-30, r:50, m:2000}, {text:"è‚šå­ç–¼ç¦»åœº", s:-10, r:-60}]},
        { img: "scene20", t: "è€æ¿çš„å¤§é¥¼", b: "è€æ¿ï¼šâ€˜æ˜å¹´äººäººé…è‚¡ä»½ï¼Œéƒ½æ˜¯åˆä¼™äººã€‚â€™", opts: [{text:"çƒ­æ³ªç›ˆçœ¶ç»§ç»­å¹²", h:-2000, s:-20, r:20}, {text:"çœ‹æ‹›è˜è½¯ä»¶", s:10, r:-10}]},
        { img: "scene21", t: "æŠ•æ ‡å†²åˆº", b: "è¶…é«˜å±‚æŠ•æ ‡24å°æ—¶ã€‚æ•ˆæœå›¾å…¬å¸è·‘è·¯äº†ã€‚", opts: [{text:"è‡ªå·±ä¸Šæ‰‹æ¸²æŸ“", h:-6000, s:-35, r:60, m:8000}, {text:"ç™½æ¨¡å¼ºè¡Œæ±‡æŠ¥", s:-30, r:-100}]},
        { img: "scene22", t: "ç”²æ–¹æš´èµ°", b: "ç”²æ–¹è¦çª—æˆ·å…¨æ”¹æˆå¤å…¸æ‹±çª—ã€‚", opts: [{text:"ç…§åšï¼Œè™½ç„¶ä¸‘", h:-4000, s:-35, r:40, m:5000}, {text:"æ¶ˆææ€ å·¥", s:-10, r:-5}]},
        { img: "scene23", t: "äºŒè½®å®¡å›¾", b: "äºŒè½®æ„è§å’Œç¬¬ä¸€è½®å®Œå…¨ç›¸åã€‚", opts: [{text:"é™·å…¥è½®å›", h:-4000, s:-30, r:30, m:2000}, {text:"ä¸ç®¡é€»è¾‘æ”¹äº†", s:-25, r:10}]},
        { img: "scene24", t: "èŒä¸šå€¦æ€ ", b: "ä½ çªç„¶å¿˜äº†ä¸ºä»€ä¹ˆè¦å½“å»ºç­‘å¸ˆã€‚", opts: [{text:"æŠ½æ ¹çƒŸç»§ç»­", h:-500, s:-20, m:200}, {text:"æ´—æ‰‹é—´ç—›å“­", s:20, r:-5}]},
        { img: "scene25", t: "AIå±æœº", b: "è€æ¿é—®ï¼šâ€˜å¦‚æœAIèƒ½ç”»å›¾ï¼Œè¿˜è¦ä½ å¹²å˜›ï¼Ÿâ€™", opts: [{text:"é’»ç ”å’’è¯­", h:-2000, s:-25, r:50, m:3000}, {text:"è¢«å†·è½", s:-20, r:-50}]},
        { img: "scene26", t: "è€å‹èšä¼š", b: "ITåŒå­¦å¹´è–ªç™¾ä¸‡ã€‚ä½ è¿˜è¦å¸­é—´å›å¾®ä¿¡ã€‚", opts: [{text:"â€˜æˆ‘æœ‰è¿½æ±‚â€™", h:-1000, s:-30, r:10}, {text:"å–é—·é…’", s:-10, r:-5}]},
        { img: "scene27", t: "ç»ˆæç›–ç« ", b: "å‡ åæœ¬åšå›¾ç­‰å¾…ç›–ç« ã€‚", opts: [{text:"é—­çœ¼ç›–ä¸‹å»", h:-2000, s:-20, r:60, m:5000}]},
        { img: "scene28", t: "ç°åœºäº‹æ•…", b: "å·¥åœ°å¡Œäº†å¢™ã€‚ç”²æ–¹è¦ä½ åœ†è°ã€‚", opts: [{text:"æ®å®è¯´æ˜", h:-2000, s:-40, r:100}, {text:"åœ†è°æ¢é’±", s:-80, r:-150, m:15000}]},
        { img: "scene29", t: "è¡Œä¸šæ•™çˆ¶", b: "è¢«è¯„ä¸ºâ€˜å¹´åº¦æ°å‡ºé’å¹´å»ºç­‘å¸ˆâ€™ã€‚", opts: [{text:"è°ˆç¢³ä»£è°¢", h:-2000, s:-20, r:200, m:10000}, {text:"æ„Ÿè°¢æ·±å¤œ", s:-30, r:100}]},
        { img: "scene30", t: "åˆä¼™äººé‚€è¯·", b: "è€æ¿é€’è¿‡ä¸€ä»½å…¥è‚¡åˆåŒã€‚", opts: [{text:"ç­¾ï¼æˆä¸ºåˆä¼™ç‰›é©¬", h:-5000, s:-30, r:150, isFinal:true}, {text:"ä¸ç­¾ï¼Œæˆ‘æƒ³ç¡è§‰", isFinal:true}]}
    ];

    const failQuit = [
        "æŠ•é€’ã€é€å¤–å–ã€‘ï¼Œä½†è„ŠæŸ±å·²ç¡¬åŒ–æ— æ³•ä½©æˆ´å¤´ç›”ã€‚å¤±è´¥ã€‚",
        "é¢è¯•ã€å¥¶èŒ¶åº—ã€‘ï¼Œåº—é•¿æ€•ä½ æ‘‡çˆ†æ¯å­ã€‚å¤±è´¥ã€‚",
        "ã€è€ƒå…¬ã€‘å¡«æ¶‚ç­”é¢˜å¡æ—¶å¯»æ‰¾å¿«æ·é”®å¯¼è‡´å¤±è´¥ã€‚å¤±è´¥ã€‚",
        "ã€æ‘Šç…é¥¼ã€‘éè¦æŒ‰é˜²ç«åˆ†åŒºåŠ é¸¡è›‹ï¼Œå‡ºé¤æ…¢è¢«æŠ•è¯‰ã€‚å¤±è´¥ã€‚"
    ];

    function initGame() {
        state = { step: 0, day: 1, hair: 100000, sanity: 100, rep: 0, money: 0 };
        document.getElementById('welcome').classList.add('hide');
        document.getElementById('game-ui').classList.remove('hide');
        render();
    }

    function render() {
        if (state.hair <= 0 || state.sanity <= 0) {
            triggerEnd("èº«ä½“å´©æºƒ", "ä½ å€’åœ¨äº†ç»˜å›¾æ¡Œä¸Šã€‚ä¸‹è¾ˆå­åˆ«å…¥è¿™è¡Œäº†ã€‚");
            return;
        }

        const data = script[state.step];
        document.getElementById('manga-img').src = `images/${data.img}.jpg`;
        document.getElementById('progress-inner').style.width = (state.step / 30 * 100) + "%";
        document.getElementById('day-val').innerText = state.day;
        document.getElementById('hair-val').innerText = (state.hair/1000).toFixed(1) + "k";
        document.getElementById('sanity-val').innerText = state.sanity;
        document.getElementById('rep-val').innerText = state.rep;
        document.getElementById('money-val').innerText = "ï¿¥" + state.money;
        document.getElementById('stage-num').innerText = `å…³å¡ ${(state.step + 1).toString().padStart(2, '0')} / 30`;
        document.getElementById('rank-name').innerText = state.rep > 300 ? 'èŒçº§ï¼šåˆä¼™äºº' : (state.rep > 80 ? 'èŒçº§ï¼šé¡¹ç›®ç»ç†' : 'èŒçº§ï¼šèŒåœºæ–°äºº');
        document.getElementById('scene-body').innerText = `ã€${data.t}ã€‘\n\n${data.b}`;

        // è­¦å‘Šè¡¥ä¸
        const hint = document.getElementById('warning-hint');
        if (state.sanity < 40) {
            hint.innerText = "ğŸš¨ è­¦å‘Šï¼šå¿ƒæ™ºæä½ï¼Œå®¹æ˜“å´©æºƒï¼å¿«å»è¡¥ç»™ç«™å–å†°ç¾å¼ï¼";
            hint.style.display = 'block';
        } else if (state.hair < 30000) {
            hint.innerText = "ğŸš¨ è­¦å‘Šï¼šå¤´çš®å‘éº»ï¼Œå‘é‡å±é™©ï¼å»ºè®®ä½¿ç”¨ç”Ÿå‘æ°´è¡¥å……ï¼";
            hint.style.display = 'block';
        } else {
            hint.style.display = 'none';
        }

        const opts = document.getElementById('options');
        opts.innerHTML = '';
        data.opts.forEach(o => {
            const b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = o.text;
            b.onclick = () => {
                state.hair += (o.h || 0);
                state.sanity += (o.s || 0);
                state.rep += (o.r || 0);
                state.money += (o.m || 0);
                state.day += Math.floor(Math.random()*15 + 10);
                if (o.isFinal) finalize();
                else { state.step++; render(); }
            };
            opts.appendChild(b);
        });

        if (Math.random() > 0.65 && !data.isFinal) {
            const bQuit = document.createElement('button');
            bQuit.className = 'opt-btn opt-quit';
            bQuit.innerText = "æˆ‘è¦è½¬è¡Œï¼";
            bQuit.onclick = () => {
                document.getElementById('quit-text').innerText = failQuit[Math.floor(Math.random()*failQuit.length)];
                document.getElementById('quit-modal').classList.remove('hide');
            };
            opts.appendChild(bQuit);
        }
    }

    function closeQuitModal() {
        document.getElementById('quit-modal').classList.add('hide');
        state.sanity -= 20;
        render();
    }

    function buyItem(type) {
        if (type === 'coffee' && state.money >= 200) {
            state.money -= 200; state.sanity = Math.min(100, state.sanity + 25);
        } else if (type === 'wig' && state.money >= 1000) {
            state.money -= 1000; state.hair += 15000;
        } else { alert("å¥–é‡‘ä¸è¶³ï¼"); }
        render();
    }

    function finalize() {
        let t, d;
        if (state.rep >= 500) {
            t = "è¡Œä¸šä¼ å¥‡"; d = "ä½ æˆä¸ºäº†åˆä¼™äººã€‚è™½ç„¶å¿˜äº†é˜³å…‰ï¼Œä½†ä½ çš„åå­—å°åœ¨æ— æ•°å›¾çº¸å³ä¸‹è§’ã€‚";
        } else if (state.sanity > 50) {
            t = "æ½‡æ´’ç¦»åœº"; d = "ä½ å›äº†è€å®¶ï¼Œæ‰¾å›äº†ç¬‘å®¹å’Œé¢ˆæ¤ã€‚";
        } else {
            t = "åº¸ç¢Œä¸€ç”Ÿ"; d = "ä½ æˆä¸ºäº†æ™®é€šçš„ç –ï¼Œç›´åˆ°é€€ä¼‘ã€‚";
        }
        triggerEnd(t, d);
    }

    function triggerEnd(title, desc) {
        document.getElementById('game-ui').classList.add('hide');
        const endPage = document.getElementById('ending');
        endPage.classList.remove('hide');
        document.getElementById('end-status').innerText = title;
        document.getElementById('end-desc').innerText = desc;

        setTimeout(() => {
            endPage.classList.add('hide');
            document.getElementById('disclaimer-page').classList.remove('hide');
        }, 5000);
    }
</script>
</body>
</html>